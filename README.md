# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Типы данных
```
type category = - категории товаров
| 'другое'
| 'софт-скил'
| 'дополнительное'
| 'кнопка'
| 'хард-скил'; 
```
## Описание данных (интерфейсы)

### Интерфейс карточки товара IProduct

- `id: string` - идентификатор карточки товара
- `title: string` - название карточки товара
- `category: category` - категория товара (тип данных category)
- `desc: string` - описание товара
- `price: number | null` - цена товара (цены может не быть)
- `image: string` - изображение товара
- `buyButton: string` - кнопка "Купить"

### Интерфейс заказа IOrder

- `payment: 'cash' | 'card'` - способ оплаты(карта или наличные)
- `mail: string` - электронный адрес
- `phone: string` - телефон
- `address: string` - адрес
- `total: number` - итоговая сумма заказа
- `items: string[]` - массив товаров в заказе

### Интерфейс страницы IPage

- `items: IProduct[]` - массив карточек товаров
- `total: number` - количество карточек

### Интерфейс корзины IBasket

- `items: iProduct[]` - массив товаров в корзине
- `total: number | null` - итоговая стоимость (если в корзину добавлены только товары из категории "Бесценно" - стоимость 0)

### Интерфейс итогового заказа IOrderResult

- `id: string` - идентификатор заказа
- `total: price` - итоговая стоимость

### Интерфейс итогового заказа IValidation

   - `valid: boolean` - валидация булевым значением
	 - `errors: string[]` - массив ошибок

# Основные события в приложении

- `basket:change` - отслеживает любые изменения в корзине
- `basket:checkout` — активируется при нажатии «Оформить» в корзине, открывает модальное окно для выбора способа оплаты и ввода адреса доставки.
- `basket:enterContacts` — срабатывает при клике на «Оформить», открывает форму для ввода контактных данных.
- `orderInput:update` — запускается при вводе данных в форму заказа или контактов, проверяет корректность введенной информации и сохраняет её.
- `contacts:send` — отправляет введенные контактные данные при завершении оформления заказа.
- `order:completed` — уведомляет о успешной оплате и отображает соответствующее сообщение.
- `input:validationError` — проверяет введённые данные в форме и сообщает об ошибках.
- `modal:show` — открывает модальное окно с предпросмотром товара при нажатии на карточку.
- `modal:hide` — закрывает модальное окно при клике вне него, нажатии кнопки «Закрыть» или клавиши Esc.
- `items:update` — обновляет список товаров на странице при его изменении.
- `card:select` — срабатывает при выборе товара, передает его данные.
- `preview:update` — изменяет содержимое модального окна при обновлении данных.
- `basket:addItem` — добавляет товар в корзину и обновляет счётчик при нажатии кнопки «В корзину».
- `basket:show` — открывает модальное окно с перечнем товаров и их общей стоимостью при нажатии на иконку корзины.
- `basket:removeItem` — удаляет товар из корзины и обновляет список с учетом изменений.

# Компоненты

Абстрактный класс Component, содержит базовые методы для работы с HTML элементами. Принимает конструктором HTML элемент (контейнер)


- `toggleClass()` - переключить класс 
- `setText()` - установить текст для элемента 
- `switchEnable ()` - заблокировать или разблокировать элемент(атрибут disabled) 
- `setHidden()` - скрыть элемент 
- `setVisible()` - показать элемент 
- `setImage()` - установить изображение 
- `render()` - ренденрит (возвращает) HTML элемент 

# Классы

## Класс Api

Содержит базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

### Методы:

`'get'` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер

`'post'` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

## Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий. Основные методы, реализуемые классом описаны интерфейсом IEvents:

`'on'` - подписка на событие \
`'emit'` - инициализация события \
`'trigger'` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

# Слой данных

## Класс AppState

Отвечает за хранение и управление всеми данными, используемыми на странице.

Конструктор принимает объект с типом IProduct, где свойства из интерфейса указываются частично.

### Поля класса:

-	`_cartItems` - массив товаров, добавленных в корзину
- `_customerData` - объект с данными пользователя для оформления заказа (адрес, email, телефон)
-	`_productList` - массив товаров, отображаемых на странице
-	`currentPreview` - хранит ID карточки товара, открытой для предпросмотра
-	`_validationErrors` - объект, содержащий ошибки валидации формы

### Cеттеры:

-	`productList()` - обновляет массив товаров и инициирует событие ‘items:updated’
-	`customerData()` - изменяет данные пользователя и запускает проверку формы

### Гeттеры:

-	`productList()` - возвращает список всех товаров
-	`customerData()` - получает объект с контактной информацией пользователя (email, телефон, адрес, способ оплаты)
-	`cartItems()` - возвращает массив товаров в корзине
-	`totalCartPrice()` - вычисляет общую стоимость товаров в корзине
-	`cartCount()` - возвращает количество товаров в корзине
-	`validationErrors()` - возвращает объект с ошибками формы

### Методы:

-	`setPreviewItem()` - сохраняет ID товара для предпросмотра и инициирует событие ‘preview:updated’
-	`getCartItemIds()` - возвращает массив ID всех товаров, добавленных в корзину
-	`findProductById()` - ищет товар по его ID в общем списке товаров и возвращает его
-	`addToCart()` - добавляет товар в корзину по ID и инициирует событие ‘cart:updated’
-	`removeFromCart()` - удаляет товар из корзины по ID и инициирует событие ‘cart:updated’
-	`clearCart()` - очищает корзину и вызывает событие ‘cart:updated’
-	`validateUserData()` - проверяет заполненность контактных данных пользователя, записывает ошибки в validationErrors и инициирует событие ‘form:error’
-	`resetOrder() `- очищает контактные данные пользователя и инициирует событие ‘form:error’
-	`updateOrderField() `- обновляет указанное поле контактных данных и запускает проверку формы
-	`isProductInCart()` - проверяет, есть ли товар в корзине по его ID, и возвращает true или false
-	`clearCustomerData() `- удаляет все данные пользователя и ошибки формы, инициирует событие ‘form:error’

# Слой представления (отрисовка)

## Класс Card

Базовый класс для всех карточек. Наследуется от Component с типом IProduct.
Принимает контейнер (HTMLElement) и объект ICardAction с параметрами:

- `onClick` – функция, вызываемая при клике.
- `price` – цена товара.
- `title` – заголовок товара.
- `index` – порядковый номер (необязательно).

Если передана функция onClick, она добавляется к кнопке или контейнеру.

### Поля класса

- `_heading` – название товара.  
-	`_cost` – стоимость товара.  
-	`_actionButton` – кнопка для взаимодействия (например, добавление в корзину).  
-	`_order` – порядковый индекс (опционально).  
### Сеттеры

-	`orderIndex` – задает порядковый индекс.  
-	`actionButton` – изменяет текст кнопки.  
-	`id` – устанавливает data-id у контейнера.  
-	`cost` – устанавливает цену (число или "Бесценно"). Если `null`, кнопка блокируется.  
-	`heading` – устанавливает заголовок.  

## Класс CardOnPage

Расширяет Card, добавляя новые поля для отображения на главной странице.

### Поля класса

-	`_image` – изображение товара.
-	`_categoryTag` – категория товара.

### Сеттеры

-	`image` – устанавливает изображение, используя this.setImage().
-	`categoryTag` – устанавливает категорию, применяет класс через toggleClass().

## Класс FullCard 

Наследуется от CardOnPage, добавляет описание для карточки когда она открыта для предпросмотра:

### Поля класса

-	`_desc` – описание товара.

### Сеттеры

-	`desc` – устанавливает описание товара.

## Класс Page

Отвечает за рендеринг главной страницы, содержит основные элементы интерфейса (корзина, счетчик товаров, контейнер с карточками).
В конструкторе происходит инициализация полей с HTML-элементами. При нажатии на кнопку корзины на нее добавляется обработчик клика, при котором отправляется событие об открытии корзины.

### Поля класса:

- `_cartCount` - отображает количество товаров в корзине  
- `_cardContainer` - элемент, содержащий карточки товаров  
- `_pageContainer` - основной контейнер страницы  
- `_cart` - элемент корзины  

### Сеттеры: 

- `setCartCount()` - обновляет значение счетчика товаров в корзине  
- `setCardContainer() `- заменяет содержимое каталога товаров  
- `toggleScrollLock()` - включает или отключает блокировку прокрутки страницы  

## Класс Basket

Отвечает за рендеринг содержимого корзины. Наследуется от компонента с типом данных из интерфейса IOrderData (содержит список HTML-элементов и итоговую сумму заказа).
В конструкторе инициализирует HTML-элементы, а если кнопка присутствует, добавляет на нее обработчик клика, который эмитирует событие basket:toOrder.

### Поля класса

- `_productList` - хранит список товаров в корзине (HTMLElement)  
- `_finalPrice` - отображает общую стоимость заказа (HTMLElement)  
- `_orderButton` - кнопка для оформления заказа (HTMLElement)  

### Сеттеры

- `setProductList()` - обновляет содержимое корзины или устанавливает текст "Корзина пуста"  
- `setFinalPrice()` - обновляет значение итоговой стоимости товаров  


## Класс Contacts

Отвечает за управление контактной информацией (телефон и email).
Конструктор передает форму и объект событий в родительский класс.

### Сеттеры

-	`phoneNumber()` – задает номер телефона.  
-	`emailAddress()` – устанавливает email.  

### Методы

-	`clearFields()` – удаляет введенные данные из полей телефона и email.  

## Класс Form 

Класс для управления формами. Наследуется от Component и принимает обобщенный тип T, который описывает структуру данных формы.
В конструкторе получает контейнер формы и объект для обработки событий (IEvents).
Инициализирует кнопку отправки формы и блок с ошибками.
Добавляет обработчик input на поля формы, который вызывает метод handleInputChange().
Добавляет обработчик submit, предотвращает стандартную отправку формы и эмитирует событие <имя формы>:submit.

### Поля класса

- `_submitBtn` - кнопка для отправки формы (HTMLButtonElement)  
- `_errorContainer` - блок для отображения сообщений об ошибках (HTMLElement)  

### Сеттеры 

- `setValidity(state: boolean)` - включает или отключает кнопку отправки формы  
- `setErrorMessage(message: string)` - выводит сообщение об ошибке в контейнер  

### Методы 
- `handleInputChange(field, value)` - эмитирует событие 'orderInput:change' с именем измененного поля и его значением  
- `render()` - принимает объект с данными формы, обновляет значения в полях ввода и возвращает контейнер формы 

## Класс Modal

Класс для управления всплывающим окном. Наследуется от Component и использует тип IModal (обязательно включает content).
Принимает контейнер модального окна и объект событий (IEvents).
Инициализирует кнопку закрытия и область для контента.
Добавляет обработчик клика на кнопку закрытия, который вызывает hideModal().
Добавляет обработчик клика на затемненный фон, закрывающий окно при клике на фон.

### Поля класса

- `_closeBtn` - кнопка для закрытия окна (HTMLButtonElement)  
- `_contentContainer` - блок для размещения содержимого модального окна (HTMLElement)  


### Сеттеры

- `setContent(value: HTMLElement)` - заменяет содержимое окна переданным элементом  

### Методы

- `showModal()` - открывает модальное окно и эмитирует событие 'modal:open'  
- `hideModal()` - закрывает окно, очищает его содержимое и эмитирует событие 'modal:close'  
- `render()` - принимает объект `IModal`, вызывает родительский `render()`, отображает модальное окно и возвращает его контейнер  

## Класс Succes 

Класс для отображения сообщения о завершении заказа.

Принимает контейнер (HTMLElement) и объект с обработчиками событий.
Находит элемент, где будет показана списанная сумма.
Ищет кнопку закрытия и добавляет обработчик клика, если передан onClick.

### Поля класса

- `_amountDisplay` - элемент, в котором показывается списанная сумма (HTMLElement)  
- `_closeButton` - кнопка для закрытия окна (HTMLButtonElement)  

### Сеттеры

- `setAmount(value: string)` - устанавливает текст "Списано {value} синапсов" в `_amountDisplay`.  

## Класс WebLarekApi

Наследуется от Api, предназначен для взаимодействия с товарами и заказами.

### Конструктор

Принимает параметры:
-	`baseUrl` – базовый URL для API-запросов.
-	`cdn` – URL для загрузки изображений товаров.
-	`options` – необязательные настройки RequestInit для запросов.

### Методы

- `getProducts()` – Получение списка товаров
- `postOrder(order: IOrderResponse)` – Отправка заказа

## Класс Order

Отвечает за выбор метода оплаты и ввод адреса. Наследуется от Form<IOrder>.

Конструктор сохраняет элементы кнопок и добавляет обработчики событий для изменения метода оплаты.

### Поля класса

-	`btnCash` – кнопка выбора оплаты наличными (`HTMLButtonElement`).  
-	`btnCard` – кнопка выбора оплаты картой (`HTMLButtonElement`).  

### Сеттеры

-	`paymentMethod()` – устанавливает способ оплаты (наличные или карта).  
-	`deliveryAddress()` – задает адрес доставки.  

### Методы

- `resetPaymentButtons()` – убирает активные классы с кнопок выбора оплаты.  
-	`clearData()` – очищает введенные данные о способе оплаты и адресе.  

